<?xml version="1.0" encoding="utf-8" ?>
<Page
    x:Class="AIDevGallery.Pages.ScenarioPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="using:AIDevGallery.Controls"
    xmlns:converters="using:CommunityToolkit.WinUI.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="using:AIDevGallery.Models"
    xmlns:ui="using:CommunityToolkit.WinUI"
    xmlns:utils="using:AIDevGallery.Utils"
    mc:Ignorable="d">
    <Page.Resources>
        <converters:StringVisibilityConverter x:Key="StringVisibilityConverter" />
        <Style
            x:Key="CustomFlyoutPresenterStyle"
            BasedOn="{StaticResource DefaultFlyoutPresenterStyle}"
            TargetType="FlyoutPresenter">
            <Setter Property="MinWidth" Value="524" />
        </Style>
    </Page.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="Auto" />
        </Grid.ColumnDefinitions>
        <Grid
            x:Name="ShadowCastGrid"
            Grid.RowSpan="5"
            Grid.ColumnSpan="2" />
        <Grid Padding="24,16,24,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>
            <TextBlock Style="{StaticResource SubtitleTextBlockStyle}" Text="{x:Bind scenario.Name}" />
            <TextBlock
                Grid.Row="1"
                Text="{x:Bind scenario.Description}"
                TextWrapping="Wrap" />
            <Button
                x:Name="ModelBtn"
                Grid.Row="2"
                Margin="0,12,0,12"
                Padding="8,6,8,6"
                Click="Button_Click">
                <StackPanel Spacing="8">
                    <TextBlock Text="No model selected" Visibility="{x:Bind utils:XamlHelpers.VisibleWhenEmpty(modelDetails), Mode=OneWay}" />
                    <ItemsRepeater ItemsSource="{x:Bind modelDetails, Mode=OneWay}">
                        <ItemsRepeater.Layout>
                            <StackLayout Orientation="Horizontal" Spacing="24" />
                        </ItemsRepeater.Layout>
                        <ItemsRepeater.ItemTemplate>
                            <DataTemplate x:DataType="models:ModelDetails">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <Image Width="16" Source="{x:Bind Icon}" />
                                    <TextBlock Text="{x:Bind Name}" />
                                    <ItemsRepeater
                                        Grid.Column="1"
                                        VerticalAlignment="Center"
                                        ItemsSource="{x:Bind HardwareAccelerators}">
                                        <ItemsRepeater.Layout>
                                            <StackLayout Orientation="Horizontal" Spacing="4" />
                                        </ItemsRepeater.Layout>
                                        <ItemsRepeater.ItemTemplate>
                                            <DataTemplate x:DataType="models:HardwareAccelerator">
                                                <Border
                                                    Padding="2,0,2,0"
                                                    Background="{ThemeResource TertiaryButtonBackground}"
                                                    BorderBrush="{ThemeResource TertiaryButtonBorderBrush}"
                                                    BorderThickness="1"
                                                    CornerRadius="{StaticResource ControlCornerRadius}">
                                                    <TextBlock
                                                        AutomationProperties.AccessibilityView="Raw"
                                                        FontSize="10"
                                                        Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                        Text="{x:Bind utils:AppUtils.GetHardwareAcceleratorString((models:HardwareAccelerator))}" />
                                                </Border>
                                            </DataTemplate>
                                        </ItemsRepeater.ItemTemplate>
                                    </ItemsRepeater>
                                </StackPanel>
                            </DataTemplate>
                        </ItemsRepeater.ItemTemplate>
                    </ItemsRepeater>
                </StackPanel>
            </Button>
        </Grid>
        <Grid
            x:Name="contentHost"
            Grid.Row="1"
            Margin="12,12,0,12"
            HorizontalAlignment="Stretch"
            Background="{ThemeResource CardGradient2Brush}"
            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
            BorderThickness="1"
            CornerRadius="8"
            Translation="0,0,16">
            <Grid.Shadow>
                <ThemeShadow x:Name="BackgroundShadow" />
            </Grid.Shadow>
            <controls:SampleContainer x:Name="SampleContainer" Visibility="Collapsed" />
            <Grid
                x:Name="NoModelSelectedGrid"
                MaxWidth="480"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                RowSpacing="8">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>
                <TextBlock>
                    <Run FontWeight="SemiBold" Text="It looks like you don't have a model or API selected." />
                    <LineBreak />
                    <LineBreak />
                    <Run Text="Select a model or API to load a sample" />
                </TextBlock>
            </Grid>
        </Grid>
        <Grid
            x:Name="LoadingGrid"
            Grid.RowSpan="2"
            Visibility="Collapsed">
            <ProgressRing x:Name="LoadingRing" IsActive="False" />
        </Grid>

        <Grid
            Grid.Row="2"
            Grid.Column="1"
            Margin="4,12,4,12"
            VerticalAlignment="Stretch"
            RowSpacing="12">
            <Grid.RowDefinitions>
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>
            <StackPanel Orientation="Vertical" Spacing="12">
                <Button
                    Padding="8,6,8,6"
                    HorizontalAlignment="Stretch"
                    Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                    Style="{StaticResource SubtleButtonStyle}"
                    ToolTipService.ToolTip="Export sample">
                    <StackPanel Orientation="Vertical" Spacing="8">
                        <FontIcon FontSize="16" Glyph="&#xE946;" />
                        <TextBlock
                            HorizontalAlignment="Center"
                            FontSize="12"
                            Text="Info" />
                    </StackPanel>
                    <Button.Flyout>
                        <Flyout Placement="Left">
                            <Grid MaxWidth="360">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="*" />
                                </Grid.RowDefinitions>
                                <TextBlock FontWeight="SemiBold" Text="How to use this sample" />
                                <TextBlock
                                    Grid.Row="1"
                                    Text="{x:Bind scenario.Instructions}"
                                    TextWrapping="Wrap" />
                            </Grid>
                        </Flyout>
                    </Button.Flyout>
                </Button>

                <Button
                    Padding="8,6,8,6"
                    HorizontalAlignment="Stretch"
                    Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                    Style="{StaticResource SubtleButtonStyle}"
                    ToolTipService.ToolTip="Export sample">
                    <StackPanel Orientation="Vertical" Spacing="4">
                        <FontIcon FontSize="16" Glyph="&#xE754;" />
                        <TextBlock
                            HorizontalAlignment="Center"
                            FontSize="12"
                            Text="Sample" />
                    </StackPanel>
                    <Button.Flyout>
                        <Flyout Placement="Left">
                            <ComboBox
                                x:Name="SampleSelection"
                                Height="28"
                                MinHeight="0"
                                Padding="8,4"
                                SelectionChanged="SampleSelection_SelectionChanged"
                                Visibility="Collapsed">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate x:DataType="models:Sample">
                                        <TextBlock Text="{x:Bind Name}" />
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>
                        </Flyout>
                    </Button.Flyout>
                </Button>

                <ToggleButton
                    x:Name="CodeToggle"
                    Padding="8,4,8,4"
                    HorizontalAlignment="Stretch"
                    AutomationProperties.Name="Show source code"
                    Background="Transparent"
                    BorderThickness="0"
                    Click="CodeToggle_Click"
                    Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                    ToolTipService.ToolTip="Show source code">
                    <StackPanel Orientation="Vertical" Spacing="4">
                        <Viewbox
                            Width="18"
                            Margin="0,-2,0,0"
                            HorizontalAlignment="Center">
                            <PathIcon Data="M8.06562 18.9434L14.5656 4.44339C14.7351 4.06542 15.1788 3.89637 15.5568 4.0658C15.9033 4.22112 16.0742 4.60695 15.9698 4.96131L15.9344 5.05698L9.43438 19.557C9.26495 19.935 8.82118 20.104 8.44321 19.9346C8.09673 19.7793 7.92581 19.3934 8.03024 19.0391L8.06562 18.9434L14.5656 4.44339L8.06562 18.9434ZM2.21967 11.4699L6.46967 7.21986C6.76256 6.92696 7.23744 6.92696 7.53033 7.21986C7.7966 7.48612 7.8208 7.90279 7.60295 8.1964L7.53033 8.28052L3.81066 12.0002L7.53033 15.7199C7.82322 16.0127 7.82322 16.4876 7.53033 16.7805C7.26406 17.0468 6.8474 17.071 6.55379 16.8531L6.46967 16.7805L2.21967 12.5305C1.9534 12.2642 1.9292 11.8476 2.14705 11.554L2.21967 11.4699L6.46967 7.21986L2.21967 11.4699ZM16.4697 7.21986C16.7359 6.95359 17.1526 6.92938 17.4462 7.14724L17.5303 7.21986L21.7803 11.4699C22.0466 11.7361 22.0708 12.1528 21.8529 12.4464L21.7803 12.5305L17.5303 16.7805C17.2374 17.0734 16.7626 17.0734 16.4697 16.7805C16.2034 16.5143 16.1792 16.0976 16.3971 15.804L16.4697 15.7199L20.1893 12.0002L16.4697 8.28052C16.1768 7.98762 16.1768 7.51275 16.4697 7.21986Z" />
                        </Viewbox>
                        <TextBlock
                            HorizontalAlignment="Center"
                            FontSize="12"
                            Text="Code" />
                    </StackPanel>
                </ToggleButton>
                <Button
                    x:Name="ExportSampleToggle"
                    Padding="8,6,8,6"
                    HorizontalAlignment="Stretch"
                    AutomationProperties.Name="Export sample"
                    Click="ExportSampleToggle_Click"
                    Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                    Style="{StaticResource SubtleButtonStyle}"
                    ToolTipService.ToolTip="Export sample">
                    <StackPanel Orientation="Vertical" Spacing="4">
                        <Viewbox Width="18">

                            <PathIcon Data="M14.516 2.319L12.064 1.092C11.8997 1.01004 11.7138 0.981779 11.5326 1.01121C11.3513 1.04064 11.1839 1.12627 11.054 1.256L6.091 6.219L2.943 3.8C2.88408 3.75474 2.81462 3.72521 2.74115 3.71419C2.66767 3.70317 2.5926 3.71102 2.523 3.737L1.284 4.2C1.19985 4.23145 1.12743 4.28807 1.07662 4.36215C1.0258 4.43623 0.999044 4.52417 1 4.614V11.007C0.999866 11.0962 1.027 11.1832 1.07776 11.2565C1.12853 11.3298 1.20049 11.3858 1.284 11.417L2.523 11.881C2.59252 11.9071 2.66754 11.9151 2.74101 11.9043C2.81448 11.8934 2.88399 11.8641 2.943 11.819L6.091 9.4L11.054 14.364C11.1839 14.4938 11.3514 14.5795 11.5327 14.6087C11.714 14.638 11.8999 14.6094 12.064 14.527L14.516 13.3C14.6611 13.2277 14.7832 13.1164 14.8686 12.9787C14.9541 12.8409 14.9996 12.6821 15 12.52V3.1C14.9998 2.93772 14.9544 2.77871 14.8689 2.64077C14.7834 2.50283 14.6612 2.39141 14.516 2.319V2.319ZM2.75 9.56V6.06L4.5 7.81L2.75 9.56ZM11.5 10.373L8.163 7.81L11.5 5.248V10.373Z" />

                        </Viewbox>
                        <TextBlock
                            HorizontalAlignment="Center"
                            FontSize="12"
                            Text="Export" />
                    </StackPanel>
                </Button>
            </StackPanel>


            <controls:CopyButton
                Grid.Row="1"
                HorizontalAlignment="Stretch"
                AutomationProperties.Name="Copy link to page"
                Click="CopyButton_Click"
                Content="{ui:FontIcon Glyph=&#xE71B;,
                                      FontSize=16}"
                ToolTipService.ToolTip="Copy link to page" />
        </Grid>

        <Grid
            Grid.Row="3"
            Margin="8"
            Padding="16,8,16,16"
            HorizontalAlignment="Stretch">

            <StackPanel
                x:Name="ButtonsPanel"
                HorizontalAlignment="Right"
                Orientation="Horizontal"
                Spacing="8"
                Visibility="Collapsed" />
        </Grid>

        <VisualStateManager.VisualStateGroups>
            <VisualStateGroup x:Name="ModelSelectionStates">
                <VisualState x:Name="PageLoading">
                    <VisualState.Setters>
                        <Setter Target="LoadingGrid.Visibility" Value="Visible" />
                        <Setter Target="LoadingRing.IsActive" Value="True" />
                        <Setter Target="NoModelSelectedGrid.Visibility" Value="Collapsed" />
                        <Setter Target="ModelBtn.Visibility" Value="Collapsed" />
                        <Setter Target="SampleContainer.Visibility" Value="Collapsed" />
                    </VisualState.Setters>
                </VisualState>
                <VisualState x:Name="NoModelSelected">
                    <VisualState.Setters>
                        <Setter Target="NoModelSelectedGrid.Visibility" Value="Visible" />
                        <Setter Target="SampleContainer.Visibility" Value="Collapsed" />
                        <Setter Target="ButtonsPanel.Visibility" Value="Collapsed" />
                    </VisualState.Setters>
                </VisualState>
                <VisualState x:Name="ModelSelected">
                    <VisualState.Setters>
                        <Setter Target="NoModelSelectedGrid.Visibility" Value="Collapsed" />
                        <Setter Target="SampleContainer.Visibility" Value="Visible" />
                        <Setter Target="ButtonsPanel.Visibility" Value="Visible" />
                    </VisualState.Setters>
                </VisualState>
            </VisualStateGroup>
        </VisualStateManager.VisualStateGroups>
    </Grid>
</Page>
